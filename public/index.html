<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiteMonkeys AI - Business Validation System</title>
    <link rel="icon" href="Apple Touch icon Site monkeys.png" type="image/png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            position: relative;
        }

        .main-logo-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 10px;
        }

        .logo {
            height: 60px;
            width: auto;
            border-radius: 8px;
            border: 2px solid #FFD700;
        }

        .main-title {
            font-size: 3.5rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            letter-spacing: 2px;
        }

        .rocket-icon {
            font-size: 2.5rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .subtitle {
            font-size: 1.3rem;
            color: #87CEEB;
            font-weight: 500;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        /* Main Container */
        .container {
            display: flex;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
            gap: 20px;
            min-height: calc(100vh - 140px);
        }

        /* Left Sidebar */
        .left-sidebar {
            width: 350px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            height: fit-content;
        }

        .mascot-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .mascot-img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 4px solid #FFD700;
            margin-bottom: 15px;
            transition: transform 0.3s ease;
        }

        .mascot-img:hover {
            transform: scale(1.05);
        }

        .mascot-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .vault-status {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .vault-status h3 {
            color: #FFD700;
            font-size: 1.4rem;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 10px;
        }

        .status-item {
            display: flex;
            align-items: center;
            margin: 12px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .status-item:hover {
            background: rgba(255, 215, 0, 0.1);
        }

        .status-check {
            color: #00ff88;
            font-size: 1.2rem;
            margin-right: 10px;
            font-weight: bold;
        }

        .status-text {
            font-size: 0.95rem;
            color: #e0e0e0;
        }

        /* Chat Area */
        .chat-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            margin: 0 10px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .chat-header {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            padding: 20px;
            text-align: center;
            color: #1a1a2e;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: white;
            min-height: 400px;
            max-height: 500px;
        }

        .message {
            display: flex;
            margin: 15px 0;
            align-items: flex-start;
            gap: 12px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid #FFD700;
            flex-shrink: 0;
        }

        .message-content {
            max-width: 70%;
            padding: 15px 18px;
            border-radius: 20px;
            font-size: 0.95rem;
            line-height: 1.5;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #1a1a2e;
            font-weight: 500;
        }

        .message.assistant .message-content {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #e9ecef;
        }

        /* Input Area */
        .input-area {
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-top: 1px solid #dee2e6;
        }

        .input-wrapper {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .message-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #FFD700;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            background: white;
            transition: all 0.3s ease;
        }

        .message-input:focus {
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
            border-color: #FFA500;
        }

        .send-button {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #1a1a2e;
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .send-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5);
        }

        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Right Sidebar */
        .right-sidebar {
            width: 350px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            height: fit-content;
        }

        /* Cost Tracking */
        .cost-tracking {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .cost-tracking h4 {
            color: #FFD700;
            font-size: 1.2rem;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 8px;
        }

        .cost-line {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 0.95rem;
        }

        .cost-label {
            color: #e0e0e0;
        }

        .cost-value {
            color: #FFD700;
            font-weight: bold;
        }

        /* Session Info */
        .session-info {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .session-info h4 {
            color: #FFD700;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .session-details {
            font-size: 0.9rem;
            color: #e0e0e0;
            line-height: 1.6;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 50%;
            border-top-color: #FFD700;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .container {
                flex-direction: column;
            }
            
            .left-sidebar, .right-sidebar {
                width: 100%;
                margin-bottom: 20px;
            }
            
            .main-title {
                font-size: 2.5rem;
            }
        }

        @media (max-width: 768px) {
            .main-logo-section {
                flex-direction: column;
                gap: 10px;
            }
            
            .main-title {
                font-size: 2rem;
            }
            
            .logo {
                height: 50px;
            }
            
            .mascot-img {
                width: 120px;
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="main-logo-section">
            <img src="logo.png" alt="SiteMonkeys Logo" class="logo">
            <h1 class="main-title">SITE MONKEYS AI</h1>
            <span class="rocket-icon">🚀</span>
        </div>
        <div class="subtitle">BUSINESS VALIDATION ENGINE</div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Left Sidebar - Eli -->
        <div class="left-sidebar">
            <div class="mascot-section">
                <img src="boy-mascot.png" alt="Eli" class="mascot-img">
                <div class="mascot-name">Eli</div>
            </div>
            
            <div class="vault-status">
                <h3>SiteMonkeys Business Validation System</h3>
                
                <div class="status-item">
                    <span class="status-check">•</span>
                    <span class="status-text">Zero-Failure AI</span>
                </div>
                <div class="status-item">
                    <span class="status-check">•</span>
                    <span class="status-text">Complete Business Intelligence</span>
                </div>
                <div class="status-item">
                    <span class="status-check">•</span>
                    <span class="status-text">Real-World Validation Ready</span>
                </div>
                <div class="status-item">
                    <span class="status-check">•</span>
                    <span class="status-text">Site Monkeys memory vault loaded</span>
                </div>
                <div class="status-item">
                    <span class="status-check">•</span>
                    <span class="status-text">Zero Failure activated</span>
                </div>
                <div class="status-item">
                    <span class="status-check">•</span>
                    <span class="status-text">Legitimate data initiative activated</span>
                </div>
                <div class="status-item">
                    <span class="status-check">•</span>
                    <span class="status-text">Persistence driven activated</span>
                </div>
                <div class="status-item">
                    <span class="status-check">•</span>
                    <span class="status-text">Helpful initiative activated</span>
                </div>
                <div class="status-item">
                    <span class="status-check">•</span>
                    <span class="status-text">Founder Protection activated</span>
                </div>
                <div class="status-item">
                    <span class="status-check">•</span>
                    <span class="status-text">Market leader Initiative</span>
                </div>
            </div>
        </div>

        <!-- Chat Container -->
        <div class="chat-container">
            <div class="chat-header">
                💬 Business Validation Chat - Session Active
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message assistant">
                    <img src="girl-mascot.png" alt="Roxy" class="message-avatar">
                    <div class="message-content">
                        Welcome to SiteMonkeys AI! I'm Roxy, and together with Eli, we're here to help you with business validation. Your complete SiteMonkeys intelligence vault is loaded and ready. Ask me anything about your business strategy, validation, or growth plans!
                    </div>
                </div>
            </div>
            
            <div class="input-area">
                <div class="input-wrapper">
                    <input 
                        type="text" 
                        class="message-input" 
                        id="messageInput" 
                        placeholder="Ask about your SiteMonkeys business validation..."
                        maxlength="500"
                    >
                    <button class="send-button" id="sendButton">
                        🐒
                    </button>
                </div>
            </div>
        </div>

        <!-- Right Sidebar - Roxy -->
        <div class="right-sidebar">
            <div class="mascot-section">
                <img src="girl-mascot.png" alt="Roxy" class="mascot-img">
                <div class="mascot-name">Roxy</div>
            </div>

            <div class="cost-tracking" id="costTracking" style="display: none;">
                <h4>💰 Cost Tracking</h4>
                <div class="cost-line">
                    <span class="cost-label">This message:</span>
                    <span class="cost-value" id="messageCost">$0.00</span>
                </div>
                <div class="cost-line">
                    <span class="cost-label">Session total:</span>
                    <span class="cost-value" id="sessionCost">$0.00</span>
                </div>
                <div class="cost-line">
                    <span class="cost-label">Today total:</span>
                    <span class="cost-value" id="dailyCost">$0.00</span>
                </div>
                <div class="cost-line">
                    <span class="cost-label">Tokens used:</span>
                    <span class="cost-value" id="tokenCount">0</span>
                </div>
            </div>

            <div class="session-info">
                <h4>📊 Business Validation Session</h4>
                <div class="session-details">
                    <strong>Status:</strong> Active<br>
                    <strong>Model:</strong> GPT-4 Turbo<br>
                    <strong>Vault:</strong> Loaded<br>
                    <strong>Budget:</strong> $15K Launch<br>
                    <strong>Margins:</strong> 87% Target<br>
                    <strong>Burn Rate:</strong> $3K/month
                </div>
            </div>
        </div>
    </div>

    <script>
        let sessionVault = null;
        let sessionActive = false;
        let sessionCostTotal = 0;
        let dailyCostTotal = parseFloat(localStorage.getItem('dailyCost') || '0');
        let messageCount = 0;
        let currentAvatar = 'girl-mascot.png'; // Start with Roxy

        // Update daily cost display
        document.getElementById('dailyCost').textContent = `$${dailyCostTotal.toFixed(4)}`;

        async function loadVaultOnce() {
            if (sessionVault) {
                return sessionVault;
            }

            try {
                console.log('Loading vault for first time this session...');
                const response = await fetch('/api/load-vault');
                const data = await response.json();
                
                if (data.vault_content) {
                    sessionVault = data.vault_content;
                    sessionActive = true;
                    console.log('Vault loaded successfully, cached for session');
                    return sessionVault;
                } else {
                    throw new Error('No vault content received');
                }
            } catch (error) {
                console.error('Vault loading failed:', error);
                return "SiteMonkeys business validation system with core intelligence loaded.";
            }
        }

        function updateCostDisplay(costData) {
            if (costData) {
                document.getElementById('messageCost').textContent = `$${costData.cost || costData.message_cost || '0.00'}`;
                
                const messageCost = parseFloat(costData.cost || costData.message_cost || 0);
                sessionCostTotal += messageCost;
                document.getElementById('sessionCost').textContent = `$${sessionCostTotal.toFixed(4)}`;
                
                dailyCostTotal += messageCost;
                document.getElementById('dailyCost').textContent = `$${dailyCostTotal.toFixed(4)}`;
                localStorage.setItem('dailyCost', dailyCostTotal.toString());
                
                document.getElementById('tokenCount').textContent = costData.tokens_used || '0';
                document.getElementById('costTracking').style.display = 'block';
            }
        }

        function addMessage(content, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            let avatarSrc;
            if (sender === 'user') {
                avatarSrc = currentAvatar;
            } else {
                // Alternate between Eli and Roxy for AI responses
                currentAvatar = currentAvatar === 'boy-mascot.png' ? 'girl-mascot.png' : 'boy-mascot.png';
                avatarSrc = currentAvatar;
            }
            
            messageDiv.innerHTML = `
                <img src="${avatarSrc}" alt="Avatar" class="message-avatar">
                <div class="message-content">${content}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Disable input during processing
            input.disabled = true;
            sendButton.disabled = true;
            sendButton.innerHTML = '<div class="loading"></div>';
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            
            try {
                // Load vault if needed (only once per session)
                const vaultMemory = await loadVaultOnce();
                
                // Send to AI
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        vault_memory: vaultMemory
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    addMessage(data.response, 'assistant');
                    
                    // Update cost tracking
                    updateCostDisplay(data);
                } else {
                    addMessage(`AI Error: ${data.error}`, 'assistant');
                }
                
            } catch (error) {
                console.error('Error:', error);
                addMessage('Connection error. Please try again.', 'assistant');
            } finally {
                // Re-enable input
                input.disabled = false;
                sendButton.disabled = false;
                sendButton.innerHTML = '🐒';
                input.focus();
            }
        }

        // Event listeners
        document.getElementById('sendButton').addEventListener('click', sendMessage);
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Auto-focus input on load
        document.getElementById('messageInput').focus();

        // Load vault on page load
        loadVaultOnce().then(() => {
            console.log('Initial vault load complete');
        });
    </script>
</body>
</html>
