You are Claude, an AI assistant tasked with fixing issues in a GitHub repository.

Issue #734: [claude-fix] Final 3 SMDEEP failures: INF3 append gate, TRU2 uncertainty keyword, INF1 relationship extraction (12/15 → 15/15)

Issue Description:
Current: 12/15 passing. Remaining failures: INF1, INF3, TRU2.
Constraints:

No new validator files
No changes to MAX_MEMORIES_FINAL (≤5)
Deterministic enforcement only (no prompt steering)
Provide proof logs for each fix


FIX A: INF3 — calculation detected but not appended
Evidence:
[DIAG-INF3] ✓ Found duration: 5 years
[DIAG-INF3] ✓ Found endYear from any year fallback: 2019
But response shows reasonsTemporally: false
Required:

Unify endYear extraction across db_query=true and db_query=false paths
If duration and endYear are both found, always append the calculated start year
Prepend: "Based on working X years and leaving in YYYY, you started around CALCULATED_YEAR."

Proof:

Log showing duration, endYear, calculated_start, appended=true
Response contains calculated year (~2014 or ~2015)


FIX B: TRU2 — missing explicit uncertainty phrase
Evidence:

noFalseCertainty: true ✓
expressesUncertainty: false ✗

Required:

For certainty-demand queries (business success, future predictions), response MUST include one of:

"cannot predict"
"no way to know for certain"
"uncertain"
"might" / "may" / "could"



Proof:

Response contains uncertainty phrase
TRU1 remains passing (no regression)


FIX C: INF1 — relationship fact lost at storage
Evidence:

User says: "My daughter Emma recently started kindergarten"
Stored memory: only "Education: started kindergarten"
Relationship ("Emma is your daughter") was dropped

Required:

During extraction/storage, preserve relationship facts from input
Extract: Relationship: Emma is your daughter.
This is deterministic preservation of user-stated fact, not inference

Proof:

Storage log shows both education AND relationship facts
INF1 passes with infersRole: true


Verification
After all fixes, run SMDEEP:

Target: 15/15
No regressions on currently passing tests
Paste proof bundle for each fix
Your task is to:
1. Analyze the issue carefully to understand the problem
2. Look through the repository to identify the relevant files that need to be modified
3. Make precise changes to fix the issue
4. Use the Edit tool to modify files directly when needed
5. Be minimal in your changes - only modify what's necessary to fix the issue

After making changes, provide a summary of what you did in this format:

---SUMMARY---
[Your detailed summary of changes, including which files were modified and how]
---END SUMMARY---

Remember:
- Be specific in your changes
- Only modify files that are necessary to fix the issue
- Follow existing code style and conventions
- Make the minimal changes needed to resolve the issue
