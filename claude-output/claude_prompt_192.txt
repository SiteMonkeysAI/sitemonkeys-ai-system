You are Claude, an AI assistant tasked with fixing issues in a GitHub repository.

Issue #192: [claude-fix] Add memory-stats endpoint to existing debug routes

Issue Description:
Problem
The /api/debug/memory-stats endpoint doesn't exist. We need to see actual database state to diagnose why the memory system test failed (8 of 10 tests failed).
Solution
Add the memory-stats route to the existing /api/routes/debug.js file.
Add this route to /api/routes/debug.js
Add this new route handler (add it near the other debug routes in the file):
javascript// Memory system database stats
router.get('/memory-stats', async (req, res) => {
  // Security: require debug mode
  if (process.env.DEBUG_MODE !== 'true') {
    return res.status(403).json({ error: 'Debug mode not enabled' });
  }

  try {
    const pool = global.memorySystem?.coreSystem?.pool;
    
    if (!pool) {
      return res.status(500).json({ 
        error: 'Database pool not available',
        memorySystemExists: !!global.memorySystem,
        coreSystemExists: !!global.memorySystem?.coreSystem
      });
    }

    const stats = {};

    // 1. Total memories
    const totalResult = await pool.query('SELECT COUNT(*) as total FROM persistent_memories');
    stats.total_memories = parseInt(totalResult.rows[0]?.total || 0);

    // 2. Memories per category
    const categoryResult = await pool.query(`
      SELECT category_name, COUNT(*) as count, SUM(token_count) as total_tokens
      FROM persistent_memories GROUP BY category_name ORDER BY count DESC
    `);
    stats.by_category = categoryResult.rows;

    // 3. Memories per user_id
    const userResult = await pool.query(`
      SELECT user_id, COUNT(*) as count, SUM(token_count) as total_tokens
      FROM persistent_memories GROUP BY user_id ORDER BY count DESC LIMIT 20
    `);
    stats.by_user = userResult.rows;

    // 4. Recent memories
    const recentResult = await pool.query(`
      SELECT id, user_id, category_name, SUBSTRING(content, 1, 150) as preview,
             token_count, relevance_score, created_at
      FROM persistent_memories ORDER BY created_at DESC LIMIT 15
    `);
    stats.recent = recentResult.rows;

    // 5. Schema
    const schemaResult = await pool.query(`
      SELECT column_name, data_type FROM information_schema.columns 
      WHERE table_name = 'persistent_memories' ORDER BY ordinal_position
    `);
    stats.schema = schemaResult.rows;

    // Build HTML
    const html = `<!DOCTYPE html>
<html>
<head>
  <title>Memory Database Stats</title>
  <style>
    body { font-family: monospace; background: #1a1a2e; color: #eee; padding: 20px; max-width: 1200px; margin: 0 auto; }
    h1 { color: #00d4ff; }
    h2 { color: #fbbf24; margin-top: 30px; }
    .big { font-size: 2.5em; color: #4ade80; }
    table { width: 100%; border-collapse: collapse; margin: 10px 0; }
    th, td { text-align: left; padding: 8px; border-bottom: 1px solid #333; }
    th { color: #00d4ff; }
    .box { background: #16213e; padding: 15px; margin: 10px 0; border-radius: 8px; }
    pre { background: #0f0f23; padding: 10px; overflow-x: auto; font-size: 11px; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>üß† Memory Database Stats</h1>
  <p>Generated: ${new Date().toISOString()}</p>
  
  <div class="box"><span class="big">${stats.total_memories}</span> total memories</div>

  <h2>üìÅ By Category</h2>
  <table>
    <tr><th>Category</th><th>Count</th><th>Tokens</th></tr>
    ${stats.by_category.map(c => `<tr><td>${c.category_name || 'NULL'}</td><td>${c.count}</td><td>${c.total_tokens || 0}</td></tr>`).join('')}
  </table>

  <h2>üë§ By User ID</h2>
  <table>
    <tr><th>User ID</th><th>Count</th><th>Tokens</th></tr>
    ${stats.by_user.map(u => `<tr><td>${u.user_id}</td><td>${u.count}</td><td>${u.total_tokens || 0}</td></tr>`).join('')}
  </table>

  <h2>üìù Recent Memories</h2>
  ${stats.recent.map(m => `
    <div class="box">
      <strong>ID ${m.id}</strong> | ${m.user_id} | ${m.category_name}<br>
      <small>Tokens: ${m.token_count} | Relevance: ${m.relevance_score} | ${m.created_at}</small>
      <pre>${m.preview}...</pre>
    </div>
  `).join('')}

  <h2>üîß Schema</h2>
  <table>
    <tr><th>Column</th><th>Type</th></tr>
    ${stats.schema.map(s => `<tr><td>${s.column_name}</td><td>${s.data_type}</td></tr>`).join('')}
  </table>

  <h2>üìä Raw JSON</h2>
  <pre>${JSON.stringify(stats, null, 2)}</pre>
</body>
</html>`;

    res.send(html);
  } catch (err) {
    res.status(500).json({ error: err.message, stack: err.stack });
  }
});
Acceptance Criteria

 Route added to /api/routes/debug.js
 Endpoint accessible at /api/debug/memory-stats
 Shows total memory count
 Shows breakdown by category
 Shows breakdown by user_id
 Shows recent memory samples
 Shows database schema
 Protected by DEBUG_MODE check
Your task is to:
1. Analyze the issue carefully to understand the problem
2. Look through the repository to identify the relevant files that need to be modified
3. Make precise changes to fix the issue
4. Use the Edit tool to modify files directly when needed
5. Be minimal in your changes - only modify what's necessary to fix the issue

After making changes, provide a summary of what you did in this format:

---SUMMARY---
[Your detailed summary of changes, including which files were modified and how]
---END SUMMARY---

Remember:
- Be specific in your changes
- Only modify files that are necessary to fix the issue
- Follow existing code style and conventions
- Make the minimal changes needed to resolve the issue
