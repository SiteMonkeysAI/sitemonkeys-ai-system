OK, no memory_system folder. Now let me create a summary of the changes made:

---SUMMARY---

## Root Cause Identified and Fixed

The issue was in the **retrieval layer**, not the storage layer. While anchors were being correctly extracted and stored to the database, they were **not being retrieved** because the SELECT query was missing the `metadata` column.

### Changes Made:

#### 1. **api/services/semantic-retrieval.js** (CRITICAL FIX)
   - **Line ~593**: Added `metadata` column to the SELECT query in `buildStandardRetrieval()` function
   - **Line ~2166**: Added `metadata` column to fingerprint lookup query
   - **Issue**: The standard retrieval query was selecting `id, user_id, content, category_name, mode, embedding, fact_fingerprint, fingerprint_confidence, relevance_score, created_at, days_ago` but was **missing `metadata`**
   - **Impact**: This meant that even though anchors were stored in `metadata.anchors`, they were never loaded from the database during retrieval
   - **Result**: The anchor preservation validator (which reads from `memory.metadata.anchors`) was receiving memories without the metadata field, causing all anchor checks to show `anchors_keys=[]`

#### 2. **api/memory/intelligent-storage.js** (DIAGNOSTIC LOGGING)
   - **Lines ~2060-2081**: Added FIX-673 diagnostic logging before INSERT to verify anchors are present in metadata before storage
   - Logs now show:
     - `[FIX-673] PRE-INSERT metadata check` - Verifies metadata.anchors exists
     - `[FIX-673] PRE-INSERT anchor counts` - Shows counts for each anchor type
     - `[FIX-673] STORING metadata` - Confirms anchors are in the object being stringified
   - **Purpose**: These logs will help verify that anchors are definitely being stored, ruling out any storage-side issues

#### 3. **api/services/supersession.js** (DIAGNOSTIC LOGGING)
   - **Lines ~454-460**: Added FIX-673 diagnostic logging for the supersession path
   - Similar logging pattern: checks metadata.anchors before INSERT in the supersession transaction
   - **Purpose**: Ensures the supersession code path (for fingerprinted facts) also properly stores anchors

### Why The Issue Occurred:

The evidence in the issue description was misleading:
- Storage logs showed: `[ANCHOR-STORAGE] stored_id=6772 anchors_keys=[pricing] unicode_count=0 pricing_count=1`
- This logging happens AFTER the INSERT and reads from the `metadata` variable in memory
- The metadata variable DID have anchors at that point
- However, the SELECT query during retrieval didn't include the `metadata` column
- So when the anchor validator tried to read `memory.metadata.anchors`, the field simply didn't exist on the retrieved memory objects

### Test Impact:

This fix should resolve:
- **A5 test failure** - explicit_token anchors (like "ZEBRA") will now be retrieved and available for matching
- **STR1 test failure** - anchors will boost retrieval relevance  
- **CMP2 test failure** - unicode anchors (international names) will be preserved during retrieval

The storage side was working correctly all along. The issue was purely in the retrieval SELECT query missing the `metadata` column.

---END SUMMARY---
