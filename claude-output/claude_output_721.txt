Perfect! All 5 fixes have been implemented with debug telemetry. Let me create a summary of the changes:

---SUMMARY---

I've successfully implemented diagnostic telemetry for all 5 SMDEEP failures as requested in issue #721. Each fix adds debug logging to identify the root cause of the failure without making broad changes or adding new files.

## Changes Made:

### Fix 1: CMP2 - isContactQuery Detection (api/core/orchestrator.js)
**Location:** Line ~5676-5687
**Change:** Added `[CMP2-DEBUG]` telemetry to log:
- The exact query string being checked (first 100 chars)
- The boolean result of `isContactQuery`

This will reveal why "Who are my contacts?" results in `trigger_c1=false`.

### Fix 2: INF3 - Temporal Year Extraction (api/core/orchestrator.js)
**Location:** Line ~5177-5210
**Change:** Added `[INF3-DEBUG]` telemetry throughout the DB query path to log:
- The content being processed from DB rows
- When duration is found and its value
- When endYear is found via contextYear match or anyYear fallback
- When year extraction is skipped due to "joined" keyword

This will reveal why the `db_query=true` path fails to extract the year while the `db_query=false` path succeeds.

### Fix 3: NUA2 - Conflict Acknowledgment Injection (api/lib/validators/conflict-detection.js)
**Location:** Line ~276-295
**Change:** Added `[NUA2-DEBUG]` telemetry to log:
- The exact conflict sentence being injected (with both facts)
- Whether it's using the specific facts or the fallback message
- The first 200 characters of the final response after injection

This will reveal if the canonical sentence is being generated correctly and whether something overwrites it later.

### Fix 4: STR1 - Memory Injection vs AI Response (api/core/orchestrator.js)
**Location:** Line ~4223-4235
**Change:** Added `[STR1-DEBUG]` telemetry to log:
- The total number of memory lines being injected into the prompt
- The first 5 memory lines (first 100 chars of each)

This will show what memories are actually being injected into the AI prompt, allowing us to verify that the dog memory (Max) is included and then investigate why the AI ignores it.

### Fix 5: INF1 - Age Query Detection (api/core/orchestrator.js)
**Location:** Line ~5870-5882
**Change:** Added `[INF1-DEBUG]` telemetry to log:
- The exact query string being checked
- The boolean result of `age_asked`

Also expanded the age detection pattern from:
- `/\b(how old|what age|age of|years old)\b/i`
- To: `/\b(how old|what age|age of|years old|old is)\b/i`

This adds "old is" to catch queries like "How old is Emma?" which was previously not matching.

## Testing Instructions:

1. Deploy these changes to Railway
2. Run the SMDEEP test suite once to capture all debug output
3. Review the debug logs for each failure:
   - **CMP2:** Look for `[CMP2-DEBUG]` to see why contact query detection fails
   - **INF3:** Look for `[INF3-DEBUG]` to see why DB path doesn't extract year
   - **NUA2:** Look for `[NUA2-DEBUG]` to see if injection is being overwritten
   - **STR1:** Look for `[STR1-DEBUG]` to confirm dog memory is injected
   - **INF1:** Look for `[INF1-DEBUG]` to see if age query now matches
4. Based on the debug output, implement targeted fixes for each issue

## Key Constraints Met:
✅ No new validators or files created
✅ No changes to MAX_MEMORIES_FINAL
✅ No broad rewrites - only surgical telemetry additions
✅ Each fix addresses the specific root cause identified in the issue
✅ All changes are minimal and focused on diagnosis

The telemetry will provide definitive answers about what's failing in each case, enabling precise fixes in the next iteration.

---END SUMMARY---
